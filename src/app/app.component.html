<div class="container">
  <header>
    <div class="header-content">
      <div>
        <h1>Savings Tracker</h1>
        <p class="subtitle">Track your savings and spending over time</p>
      </div>
      <button 
        (click)="toggleDarkMode()" 
        class="theme-toggle"
        [attr.aria-label]="darkMode ? 'Switch to light mode' : 'Switch to dark mode'"
        title="{{ darkMode ? 'Switch to light mode' : 'Switch to dark mode' }}"
      >
        <svg *ngIf="!darkMode" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
        <svg *ngIf="darkMode" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
      </button>
    </div>
  </header>

  <div class="stats-grid">
    <div class="stat-card savings">
      <h3>Total Savings</h3>
      <p class="amount positive">£{{ getTotalSavings().toFixed(2) }}</p>
    </div>
    <div class="stat-card spend">
      <h3>Total Spending</h3>
      <p class="amount negative">£{{ getTotalSpend().toFixed(2) }}</p>
    </div>
    <div class="stat-card net">
      <h3>Net Savings</h3>
      <p class="amount" [class.positive]="getNetSavings() >= 0" [class.negative]="getNetSavings() < 0">
        £{{ getNetSavings().toFixed(2) }}
      </p>
    </div>
  </div>

  <div class="input-section">
    <div class="input-group">
      <label for="savings">Add Savings</label>
      <div class="input-wrapper">
        <span class="currency">£</span>
        <input 
          type="number" 
          id="savings" 
          [(ngModel)]="savingsAmount" 
          placeholder="0.00"
          min="0"
          step="0.01"
          (keyup.enter)="addSavings()"
        />
        <button (click)="addSavings()" class="btn btn-primary">Add</button>
      </div>
    </div>

    <div class="input-group">
      <label for="spend">Add Spending</label>
      <div class="input-wrapper">
        <span class="currency">£</span>
        <input 
          type="number" 
          id="spend" 
          [(ngModel)]="spendAmount" 
          placeholder="0.00"
          min="0"
          step="0.01"
          (keyup.enter)="addSpend()"
        />
        <button (click)="addSpend()" class="btn btn-secondary">Add</button>
      </div>
      <input 
        type="text" 
        id="spendDescription" 
        [(ngModel)]="spendDescription" 
        placeholder="What did you spend on? (optional)"
        class="description-input"
        (keyup.enter)="addSpend()"
      />
    </div>
  </div>

  <div class="chart-section">
    <div class="chart-header">
      <h2>Savings Over Time</h2>
      <div class="chart-actions">
        <input 
          type="file" 
          id="csvFileInput" 
          accept=".csv" 
          style="display: none;"
          (change)="onFileSelected($event)"
        />
        <button (click)="triggerFileInput()" class="btn btn-import">Import CSV</button>
        <button (click)="exportToCSV()" class="btn btn-export">Export CSV</button>
        <button (click)="clearData()" class="btn btn-danger">Clear All Data</button>
      </div>
    </div>
    <div class="chart-container">
      <canvas #chartCanvas></canvas>
    </div>
  </div>

  <div class="transactions-section" *ngIf="transactions.length > 0">
    <div class="transactions-header">
      <h2>Recent Transactions</h2>
      <div class="limit-selector">
        <label for="transactionLimit">Show:</label>
        <select 
          id="transactionLimit" 
          [ngModel]="transactionLimit"
          (ngModelChange)="onLimitChange($event)"
          class="limit-select"
        >
          <option *ngFor="let limit of limitOptions" [value]="limit">{{ limit }}</option>
        </select>
      </div>
    </div>
    <div class="transactions-list">
      <div 
        *ngFor="let transaction of getDisplayedTransactions()" 
        class="transaction-item"
        [class.savings]="transaction.type === 'savings'"
        [class.spend]="transaction.type === 'spend'"
      >
        <div class="transaction-info">
          <span class="transaction-type">{{ transaction.type === 'savings' ? 'Savings' : 'Spending' }}</span>
          <span class="transaction-date">{{ transaction.date.toLocaleDateString() }}</span>
          <span class="transaction-description" *ngIf="transaction.description">{{ transaction.description }}</span>
        </div>
        <span class="transaction-amount" [class.positive]="transaction.type === 'savings'" [class.negative]="transaction.type === 'spend'">
          {{ transaction.type === 'savings' ? '+' : '-' }}£{{ transaction.amount.toFixed(2) }}
        </span>
      </div>
    </div>
    <div class="pagination" *ngIf="getTotalPages() > 1">
      <button 
        (click)="previousPage()" 
        [disabled]="currentPage === 1"
        class="pagination-btn"
        [class.disabled]="currentPage === 1"
      >
        Previous
      </button>
      <div class="page-numbers">
        <button
          *ngFor="let page of getPageNumbers()"
          (click)="goToPage(page)"
          [class.active]="page === currentPage"
          class="page-number"
        >
          {{ page }}
        </button>
      </div>
      <button 
        (click)="nextPage()" 
        [disabled]="currentPage === getTotalPages()"
        class="pagination-btn"
        [class.disabled]="currentPage === getTotalPages()"
      >
        Next
      </button>
    </div>
    <p class="transaction-count">
      Page {{ currentPage }} of {{ getTotalPages() }} ({{ transactions.length }} total transactions)
    </p>
  </div>
</div>
